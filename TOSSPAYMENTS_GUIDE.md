# 토스페이먼츠 결제 연동 가이드

## 📋 준비사항

### 1. 토스페이먼츠 테스트 키 발급
1. [토스페이먼츠 개발자센터](https://developers.tosspayments.com/) 접속
2. 회원가입/로그인
3. 대시보드에서 테스트 API 키 확인
   - 테스트 클라이언트 키: `test_ck_...`
   - 테스트 시크릿 키: `test_sk_...`

### 2. .env 파일 설정
```env
TOSS_SANDBOX=true
TOSS_TEST_CLIENT_KEY=test_ck_여기에_실제_키_입력
TOSS_TEST_SECRET_KEY=test_sk_여기에_실제_키_입력
```

### 3. 마이그레이션 실행
```cmd
cd C:\xampp\htdocs\mysite\newphp\shop-project

# 새로운 테이블 생성
C:\xampp\php\php.exe artisan migrate
```

## 🧪 테스트 카드 정보

토스페이먼츠 샌드박스에서 사용할 수 있는 테스트 카드:

### 정상 결제 테스트
- 카드번호: `4242 4242 4242 4242`
- 유효기간: 미래 날짜 (예: 12/30)
- CVC: 임의 3자리 (예: 123)
- 비밀번호: 임의 2자리 (예: 00)

### 결제 실패 테스트
- 카드번호: `4000 0000 0000 0002`
- 나머지는 동일

## 🛒 결제 테스트 절차

1. **상품 장바구니 담기**
   - 홈페이지에서 원하는 상품 선택
   - "장바구니 담기" 버튼 클릭

2. **로그인**
   - 상단 "로그인" 클릭
   - 계정이 없으면 "회원가입"

3. **장바구니 확인**
   - 상단 "장바구니" 클릭
   - 상품 확인 후 "결제하기" 버튼 클릭

4. **배송 정보 입력**
   - 받는 분 성함
   - 연락처 (예: 010-1234-5678)
   - 배송 주소
   - 동의 체크박스 선택
   - "결제하기" 버튼 클릭

5. **토스페이먼츠 결제**
   - 카드 결제 선택
   - 테스트 카드 정보 입력
   - 결제 진행

6. **결제 완료**
   - 주문 완료 페이지 확인
   - 영수증 보기 가능
   - 주문 상세보기 가능

## 📱 주요 페이지 URL

- 홈페이지: http://127.0.0.1:8000
- 장바구니: http://127.0.0.1:8000/cart
- 결제: http://127.0.0.1:8000/checkout
- 주문내역: http://127.0.0.1:8000/orders
- 대시보드: http://127.0.0.1:8000/dashboard

## ⚠️ 주의사항

1. **실제 결제 불가**
   - 샌드박스 모드에서는 실제 결제가 이루어지지 않습니다
   - 테스트 목적으로만 사용하세요

2. **로그인 필수**
   - 결제는 로그인한 사용자만 가능합니다
   - 비로그인 시 로그인 페이지로 이동합니다

3. **장바구니 비어있음**
   - 장바구니가 비어있으면 결제 페이지 접근 불가
   - 먼저 상품을 담아주세요

## 🔧 트러블슈팅

### "Missing required parameter" 오류
- .env 파일에 토스페이먼츠 키가 제대로 설정되었는지 확인
- 설정 후 서버 재시작 필요

### "Invalid client key" 오류
- 테스트 클라이언트 키가 `test_ck_`로 시작하는지 확인
- 복사 시 공백이 포함되지 않았는지 확인

### 결제 후 오류 페이지
- 콜백 URL이 올바른지 확인
- APP_URL이 http://127.0.0.1:8000 으로 설정되었는지 확인

## 📝 추가 개발 필요사항

1. **이메일 알림**
   - 주문 확인 이메일
   - 결제 완료 이메일

2. **재고 관리**
   - 주문 시 재고 차감
   - 품절 처리

3. **주문 취소/환불**
   - 토스페이먼츠 취소 API 연동
   - 환불 프로세스

4. **배송 관리**
   - 배송 상태 추가
   - 송장번호 관리

5. **프로덕션 전환**
   - 실제 API 키로 변경
   - TOSS_SANDBOX=false 설정
